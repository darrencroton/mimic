# Mimic Testing Infrastructure

**Status**: Phase 3 Complete (Module System Testing)
**Last Updated**: 2025-11-09

This directory contains Mimic's automated testing infrastructure. For detailed information on writing tests, debugging failures, and CI integration, see **[`docs/developer/testing.md`](../docs/developer/testing.md)**.

---

## Quick Start

```bash
# Run all tests
make test

# Run specific test tiers
make test-unit          # C unit tests (<10s)
make test-integration   # Python integration tests (<1min)
make test-scientific    # Python scientific tests (<5min)
```

---

## Test Organization

Tests follow the **testing pyramid** approach:

```
         /\
        /  \       Scientific Tests (physics validation)
       /____\
      /      \     Integration Tests (end-to-end workflows)
     /________\
    /          \   Unit Tests (component testing)
   /____________\
```

### 1. Unit Tests (`unit/`)
- **Purpose**: Test individual components in isolation
- **Language**: C
- **Runtime**: <10 seconds total
- **Count**: 6 tests

**Tests**: memory, properties, parameters, trees, numerics, module configuration

### 2. Integration Tests (`integration/`)
- **Purpose**: Test complete workflows end-to-end
- **Language**: Python
- **Runtime**: <1 minute total
- **Count**: 4 tests

**Tests**: full pipeline, output formats, regression, module workflows

### 3. Scientific Tests (`scientific/`)
- **Purpose**: Validate physics correctness
- **Language**: Python
- **Runtime**: <5 minutes total
- **Count**: 2 tests

**Tests**: physics sanity checks, property range validation

---

## Directory Structure

```
tests/
├── unit/                      # C unit tests
├── integration/               # Python integration tests
├── scientific/                # Python scientific tests
├── data/                      # Test data and outputs
│   ├── input/                 # Input test data (trees_063.0, millennium.a_list)
│   └── output/                # Test outputs
│       ├── baseline/          # Static reference (committed to git, never regenerated)
│       ├── binary/            # Test output, binary format (gitignored)
│       └── hdf5/              # Test output, HDF5 format (gitignored)
└── framework/                 # Test framework and templates
    ├── test_framework.h       # C testing macros
    ├── data_loader.py         # Binary file loader
    └── *_template.*           # Templates for new tests
```

---

## Test Data

**Input files** (`data/input/`):
- `trees_063.0` (17M) - Single merger tree file
- `millennium.a_list` (577B) - Snapshot ages/redshifts

**Output directories** (`data/output/`):
- `baseline/` - **Static reference data** (committed to git, NEVER regenerated by tests)
  - Used as comparison baseline for regression testing
  - Established once and preserved across all test runs
  - Contains known-good output from validated Mimic run
- `binary/` - Test output from binary format runs (gitignored, regenerated by tests)
  - Tests write here and compare against baseline/
- `hdf5/` - Test output from HDF5 format runs (gitignored, regenerated by tests)
  - Tests write here and compare against baseline/

---

## Adding New Tests

1. Choose test type (unit/integration/scientific)
2. Copy appropriate template from `framework/`
3. Implement test following the template structure
4. Add to test runner (C tests: `unit/run_tests.sh`)
5. Verify: `make test`

See **[`docs/developer/testing.md`](../docs/developer/testing.md)** for detailed instructions and examples.

---

## Test Framework

### C Unit Tests
- Framework: `framework/test_framework.h`
- Macros: `TEST_ASSERT`, `TEST_RUN`, `TEST_SUMMARY`
- Features: Memory leak detection, setup/execute/verify/cleanup structure

### Python Tests
- Compatible with standalone execution or pytest
- Helper utilities in `framework/data_loader.py`

---

## Continuous Integration

All tests run automatically on every commit via GitHub Actions.

**Requirements for merge**:
- ✅ All tests pass
- ✅ No memory leaks
- ✅ Property metadata up-to-date
- ✅ Code quality checks pass

---

## Documentation

**Comprehensive guide**: [`docs/developer/testing.md`](../docs/developer/testing.md)

**Topics covered**:
- Detailed testing philosophy and standards
- Test output formatting requirements
- How to write unit/integration/scientific tests
- Template usage and examples
- Debugging test failures
- CI integration details
- Best practices and common patterns

---

**Last Updated**: 2025-11-09 (Phase 3 Complete)
